
---
story_id: 7.1.5
epic_id: 7.1
title: "Implement Sales Automation API Routes"
status: "Draft"
priority: "P0 (Critical - Unblocks Sales UI)"
estimate: "5 story points"
dev_agent: "TBD"
---

# Story 7.1.5: Implement Sales Automation API Routes

**As a** Frontend Developer,
**I want** a stable and documented set of API endpoints for the Sales Automation service,
**so that** I can build UI features for managing the entire quote-to-revenue lifecycle.

## Story Overview

This story creates the API layer that connects the powerful, existing `salesAutomationService.ts` to the rest of the application. While the original epic (7.1) breaks the work into four stories, the backend service was implemented as a single, consolidated service. This story will expose all of that service's functionality (Products, Quotes, Contracts, Invoices, Payments, Revenue Recognition) through a unified set of RESTful endpoints.

## Acceptance Criteria

- [ ] A new `salesRoutes.ts` file is created in the `server/routes/` directory.
- [ ] Endpoints for managing Products, Quotes, Contracts, and Invoices are implemented, mapping directly to methods in `salesAutomationService.ts`.
- [ ] All API routes are protected by the `requireAuth` middleware.
- [ ] The new router is integrated into the main Express app in `server/index.ts`.
- [ ] Unit tests are created for the new routes, mocking the service layer to ensure only routing logic is tested.

## Tasks / Subtasks

- [ ] **Task 1: Create Sales Routes File & Integrate** (AC: 1, 4)
    - [ ] Create the file `server/routes/salesRoutes.ts`.
    - [ ] Set up the Express router and import the `SalesAutomationService` instance.
    - [ ] Add the new `salesRouter` to the main Express app in `server/index.ts` under the `/api/sales` path.

- [ ] **Task 2: Implement Quote Management Endpoints** (AC: 2, 3)
    - [ ] Implement `POST /quotes` to call `generateQuote`.
    - [ ] Implement `POST /quotes/:id/submit` to call `submitQuoteForApproval`.
    - [ ] *Add GET, LIST, and UPDATE endpoints for quotes if corresponding service methods exist.*

- [ ] **Task 3: Implement Contract Management Endpoints** (AC: 2, 3)
    - [ ] Implement `POST /contracts` to call `generateContract`.
    - [ ] *Add GET, LIST, and UPDATE endpoints for contracts if corresponding service methods exist.*

- [ ] **Task 4: Implement Invoice & Revenue Endpoints** (AC: 2, 3)
    - [ ] Implement `POST /invoices` to call `generateInvoice`.
    - [ ] Implement `POST /revenue/record` to call `recordRevenueRecognition`.
    - [ ] *Add GET and LIST endpoints for invoices and revenue records if corresponding service methods exist.*

- [ ] **Task 5: Create Unit Tests** (AC: 5)
    - [ ] Create `server/routes/salesRoutes.test.ts`.
    - [ ] Write basic tests for each endpoint to verify route registration, request handling, and service method invocation. Mock the `salesAutomationService` dependency.

## Dev Notes

This story is critical for enabling any UI development for the Sales Automation epic.

-   **Framework**: Use Express.js, as defined in `docs/architecture.md`.
-   **Authentication**: All routes must be protected. Use the `requireAuth` middleware from `server/middleware/authorizationMiddleware.ts`.
-   **Service Location**: The service to be used is the `SalesAutomationService` class located in `server/services/salesAutomationService.ts`.
-   **API Endpoint Design**: You will need to define the RESTful API endpoints. Base the design on the methods available in `salesAutomationService.ts`. For example, the `generateQuote` method should correspond to `POST /api/sales/quotes`.
-   **Project Structure**: The new route file must be created at `server/routes/salesRoutes.ts`. [Source: `docs/architecture.md`]

### Testing
-   **Testing Strategy**: Unit tests are required for the routing layer.
-   **Test File Location**: `server/routes/salesRoutes.test.ts`.
-   **Framework**: Use `vitest`.
-   **Guidance**: Mock the `salesAutomationService` dependency to isolate the routes for testing. Focus on verifying that the correct service methods are called with the correct parameters based on the incoming request.

## Change Log

| Date       | Version | Description                 | Author       |
|------------|---------|-----------------------------|--------------|
| 2025-09-21 | 1.0     | Initial draft of API story. | Bob (Scrum Master) |
