
---
story_id: 7.1.6
epic_id: 7.1
title: "Implement Sales Automation DB Migration"
status: "Draft"
priority: "P0 (Critical - Blocker for Sales API)"
estimate: "3 story points"
dev_agent: "TBD"
---

# Story 7.1.6: Implement Sales Automation DB Migration

**As a** Developer,
**I want** to create and apply a database migration for the new Sales Automation tables,
**so that** the database schema is synchronized with the application's data models.

## Story Overview

This technical story updates the database schema for the Sales Automation epic. It involves using Drizzle to generate and apply a migration that creates the tables required by the `salesAutomationService.ts`, including `Product`, `SalesQuote`, `Contract`, `Invoice`, and `Payment`.

## Acceptance Criteria

- [ ] A new SQL migration file is generated using `drizzle-kit`.
- [ ] The migration file contains the `CREATE TABLE` statements for all sales-related tables.
- [ ] The migration is successfully applied to the development database.
- [ ] The database schema is inspected and confirmed to match the data models defined in `salesAutomationService.ts` and `docs/architecture.md`.

## Tasks / Subtasks

- [ ] **Task 1: Define Sales Schemas in `shared/schema.ts`**
    - [ ] Add the Drizzle schema definitions for `products`, `salesQuotes`, `contracts`, `invoices`, and `payments` to `shared/schema.ts` based on the data models in `docs/architecture.md`.

- [ ] **Task 2: Generate and Apply Migration**
    - [ ] Run the `drizzle-kit` command to generate a new migration file.
    - [ ] Review the generated SQL to ensure it is correct.
    - [ ] Run the command to apply the migration to the database.

- [ ] **Task 3: Verify Database Schema**
    - [ ] Connect to the PostgreSQL database and verify that the new tables and columns exist as defined.

## Dev Notes

-   **ORM**: Drizzle ORM
-   **Schema Definition Source**: The data models are defined in `docs/architecture.md`. You will need to translate these into Drizzle schema definitions in `shared/schema.ts` before generating the migration.
-   **Tooling**: Use `drizzle-kit` to generate the migration.

## Change Log

| Date       | Version | Description                        |
|------------|---------|------------------------------------|
| 2025-09-21 | 1.0     | Initial draft of DB migration story. |
