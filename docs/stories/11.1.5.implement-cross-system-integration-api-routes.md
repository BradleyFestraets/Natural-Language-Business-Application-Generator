
---
story_id: 11.1.5
epic_id: 11.1
title: "Implement Cross-System Integration API Routes"
status: "Draft"
priority: "P1 (High - Unblocks Workflow UI)"
estimate: "5 story points"
dev_agent: "TBD"
---

# Story 11.1.5: Implement Cross-System Integration API Routes

**As a** System Administrator,
**I want** a stable set of API endpoints for the Cross-System Integration service,
**so that** I can create, manage, and monitor business workflows and data flows from an admin dashboard.

## Story Overview

This story creates the API layer for the `crossSystemIntegrationService.ts`, the central nervous system of the platform. These endpoints will expose the service's ability to orchestrate complex workflows that span multiple business systems (CRM, Sales, etc.), manage data synchronization, and provide analytics on integration performance. This is the final API story required to make the entire backend suite of services accessible.

## Acceptance Criteria

- [ ] A new `integrationRoutes.ts` file is created in the `server/routes/` directory.
- [ ] Endpoints for managing Business Workflows, Data Flows, and retrieving analytics are implemented.
- [ ] All routes correctly call the corresponding methods in `crossSystemIntegrationService.ts`.
- [ ] All API routes are protected by the `requireAuth` middleware.
- [ ] The new router is integrated into the main Express app in `server/index.ts`.
- [ ] Unit tests are created for the new routes, mocking the service layer.

## Tasks / Subtasks

- [ ] **Task 1: Create and Integrate Integration Routes File** (AC: 1, 5)
    - [ ] Create the file `server/routes/integrationRoutes.ts`.
    - [ ] Set up the Express router and import the `CrossSystemIntegrationService` instance.
    - [ ] Add the new `integrationRouter` to the main Express app in `server/index.ts` under the `/api/integration` path.

- [ ] **Task 2: Implement Workflow Endpoints** (AC: 2, 3)
    - [ ] Implement `POST /workflows` to call `createBusinessWorkflow`.
    - [ ] Implement `POST /workflows/:id/execute` to call `executeWorkflow`.
    - [ ] Implement `GET /workflows/analytics` to call `getWorkflowAnalytics`.

- [ ] **Task 3: Implement Data Flow & Integration Endpoints** (AC: 2, 3)
    - [ ] Implement `POST /data-flows` to call `createDataFlow`.
    - [ ] Implement `GET /status` to call `getIntegrationStatus`.
    - [ ] *Note: The `processIntegrationEvent` method is likely triggered internally by other services or webhooks and may not need a direct public endpoint.*

- [ ] **Task 4: Create Unit Tests** (AC: 6)
    - [ ] Create `server/routes/integrationRoutes.test.ts`.
    - [ ] Write basic tests for each new endpoint, mocking the `crossSystemIntegrationService` dependency.

## Dev Notes

This is the final and most critical API story for enabling the full platform vision.

-   **Framework**: Use Express.js, as defined in `docs/architecture.md`.
-   **Authentication**: All routes must be protected. Use the `requireAuth` middleware from `server/middleware/authorizationMiddleware.ts`.
-   **Service Location**: The service to be used is the `CrossSystemIntegrationService` class located in `server/services/crossSystemIntegrationService.ts`.
-   **API Endpoint Design**: Define RESTful endpoints based on the methods in `crossSystemIntegrationService.ts`. For example, `createBusinessWorkflow` should map to `POST /api/integration/workflows`.
-   **Project Structure**: The new route file must be created at `server/routes/integrationRoutes.ts`.

### Testing
-   **Testing Strategy**: Unit tests are required for the routing layer.
-   **Test File Location**: `server/routes/integrationRoutes.test.ts`.
-   **Framework**: Use `vitest`.
-   **Guidance**: Mock the `crossSystemIntegrationService` dependency to isolate the routes for testing.

## Change Log

| Date       | Version | Description                 | Author       |
|------------|---------|-----------------------------|--------------|
| 2025-09-21 | 1.0     | Initial draft of API story. | Bob (Scrum Master) |
